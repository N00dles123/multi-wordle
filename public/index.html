<!DOCTYPE html>
<html lang = "en">
    <meta charset="UTF-8">
      <link rel="stylesheet" href="/css/style.css" rel="stylesheet" />
      <title>Muldle - Multiplayer Wordle</title>
      <h1> Muldle - multiplayer wordle </h1>  
      <div id="container">
            <div class="card">
              <h1 id = loginTitle>Login</h1>
              <form id="login-form">
                <input id="userid" placeholder="Username"> </input>
                <input id="password" type="password" placeholder="Password"></input>
                <input id="login" type="submit" value="Login Form"></button>
              </form>
              <script>
                const loginForm = document.getElementById('login-form');
                loginForm.addEventListener('submit', login);
                
                async function login(event){
                  event.preventDefault();
                  const username = document.getElementById('userid').value;
                  const password = document.getElementById('password').value;
                  if(username == "" || password == ""){
                    alert("there are empty fields!");
                    return;
                  }
                  const result = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json'
                    },
                    body: JSON.stringify({
                        username,
                        password
                    })
                  }).then((res) => res.json());

                  if(result.status === 'ok'){
                    //everything is fine
                    document.getElementById('userid').value = '';
                    document.getElementById('password').value = '';

                    alert('Login Success!');

                  } else {
                    alert(result.error);
                  }
                }
              </script>
            </div>
            <div class="signup">
              <h1 id = loginTitle>Don't Have an Account? Sign up</h1>
              <form id="reg-form">
                <input id="userEmail" placeholder="Your Email" > </input>
                <input id="uid" type="text" placeholder="Username" > </input>
                <input id="pwd" type="password" placeholder="Password"> </input>
                <input id="pwdRep" type="password" placeholder="Password repeat"> </input>
                <input id="register" type="submit" value="Submit Form"></input>
              </form>
              <script>
                const form = document.getElementById('reg-form');
                form.addEventListener('submit', registerUser);
                
                // will send data by JSON
                async function registerUser(event) {
                  event.preventDefault();
                  let origin = window.location;
                  const email = document.getElementById('userEmail').value;
                  const uid = document.getElementById('uid').value;
                  const pwd = document.getElementById('pwd').value;
                  const dupPwd = document.getElementById('pwdRep').value;
                  const numWins = 0;
                  if(pwd != dupPwd){
                    paragraph = document.getElementById("passmatch");
                    paragraph.textContext = "Passwords do not match";
                    paragraph.style.color = "red";
                    alert("Passwords do not match");
                    return;
                  }
                  if(email == "" || uid == "" || pwd == "" || dupPwd == ""){
                    alert("There are empty fields");
                    return;
                  }
                  const result = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                      email, 
                      uid, 
                      pwd,
                      numWins 
                    })
                  }).then((res) => res.json());
                  console.log(result);

                  if(result.status === 'ok'){
                    document.getElementById('userEmail').value = '';
                    document.getElementById('uid').value = '';
                    document.getElementById('pwd').value = '';
                    document.getElementById('pwdRep').value = '';
                    alert('Success motherfucker');
                  } else {
                    alert(result.error);
                  }
                  
                  //console.log(location.href);
                }
              </script>
            </div>
      </div>
</html>
</html>

